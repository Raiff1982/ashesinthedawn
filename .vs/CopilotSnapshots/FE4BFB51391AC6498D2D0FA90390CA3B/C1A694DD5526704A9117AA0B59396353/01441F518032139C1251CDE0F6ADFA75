/**
 * Integration Hook for All UX Enhancements
 * Centralized error handling, loading states, and user feedback
 */

import { useCallback } from 'react';
import { useDAW } from '../contexts/DAWContext';
import { useErrors } from './useErrors';
import { useToast } from '../components/UX/Toast';
import { useLoadingState } from './useLoadingState';
import { createFileTooBigError, createNoTrackSelectedError, createClippingWarning } from '../lib/errorHandling';

export function useUXEnhancements() {
  const { registerError } = useErrors();
  const { addToast } = useToast();
  const { withLoading, isLoading } = useLoadingState();

  const handleFileUpload = useCallback(
    async (file: File, onUpload: (file: File) => Promise<boolean>) => {
      // ENHANCEMENT #2: Smart error messages
      if (file.size > 100 * 1024 * 1024) {
        registerError(createFileTooBigError(file.name, file.size));
        return;
      }

      // ENHANCEMENT #10: Long operation feedback
      await withLoading('file-upload', async () => {
        const success = await onUpload(file);
        if (success) {
          // ENHANCEMENT #5: Toast notification
          addToast(`Imported ${file.name} successfully! 🎉`, 'success');
        }
      });
    },
    [registerError, addToast, withLoading]
  );

  const validateTrackOperation = useCallback(
    (selectedTrack: any, operation: string) => {
      if (!selectedTrack) {
        // ENHANCEMENT #2: Friendly error message
        registerError(createNoTrackSelectedError());
        return false;
      }
      return true;
    },
    [registerError]
  );

  return {
    handleFileUpload,
    validateTrackOperation,
    showClippingWarning: (trackName: string) =>
      registerError(createClippingWarning(trackName)),
  };
}