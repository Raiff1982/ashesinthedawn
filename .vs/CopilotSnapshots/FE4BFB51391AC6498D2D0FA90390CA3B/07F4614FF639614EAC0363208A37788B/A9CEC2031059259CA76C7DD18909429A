/**
 * STEREO WIDTH CONTROL
 * Adjust stereo image width from mono (0%) to ultra-wide (200%)
 */

import { useState } from 'react';
import { Volume2 } from 'lucide-react';
import { Tooltip } from './TooltipProvider';

interface StereoWidthControlProps {
  trackId: string;
  stereoWidth: number;
  onStereoWidthChange: (width: number) => void;
  height?: number;
}

export function StereoWidthControl({
  trackId,
  stereoWidth = 100,
  onStereoWidthChange,
  height = 120,
}: StereoWidthControlProps) {
  const [isHovering, setIsHovering] = useState(false);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const newWidth = parseFloat(e.target.value);
    onStereoWidthChange(newWidth);
  };

  // Calculate stereo field visualization
  const getStereoFieldColor = (width: number) => {
    if (width < 50) return '#ff6b6b'; // Mono (red)
    if (width < 100) return '#ffa500'; // Narrow (orange)
    if (width === 100) return '#52b788'; // Normal (green)
    return '#3a86ff'; // Wide (blue)
  };

  const getFieldLabel = (width: number) => {
    if (width < 50) return 'MONO';
    if (width < 100) return 'NARROW';
    if (width === 100) return 'NORMAL';
    if (width <= 150) return 'WIDE';
    return 'ULTRA-WIDE';
  };

  return (
    <div className="space-y-2 p-3 bg-gray-800 rounded-lg border border-gray-700">
      <div className="flex items-center justify-between">
        <label className="text-xs font-semibold text-gray-400 flex items-center gap-1">
          <Volume2 className="w-3 h-3" />
          STEREO WIDTH
        </label>
        <span className="text-xs font-mono bg-gray-900 px-2 py-1 rounded text-gray-300">
          {stereoWidth.toFixed(0)}%
        </span>
      </div>

      <Tooltip
        content={{
          title: 'Stereo Width',
          description:
            'Adjust the stereo image width. 0% = Mono (center), 100% = Normal stereo, 200% = Ultra-wide (exaggerated sides)',
          category: 'mixer',
          relatedFunctions: ['Pan', 'Phase Correlation', 'Stereo Imaging'],
          performanceTip: 'Use values >100% carefully on master bus to avoid translation issues on mono speakers',
          examples: [
            'Vocals: 100% (centered stereo)',
            'Drums: 80-120% (slight width)',
            'Ambience: 150%+ (wide, spacious)',
            'Kick/Bass: 50-80% (mostly mono for translation)',
          ],
        }}
        position="top"
      >
        <div className="space-y-2">
          {/* Slider */}
          <input
            type="range"
            min="0"
            max="200"
            step="5"
            value={stereoWidth}
            onChange={handleChange}
            onMouseEnter={() => setIsHovering(true)}
            onMouseLeave={() => setIsHovering(false)}
            className="w-full h-2 bg-gradient-to-r from-red-600 via-green-600 to-blue-600 rounded-lg appearance-none cursor-pointer accent-blue-500"
            style={{
              filter: isHovering ? 'brightness(1.1)' : 'brightness(1)',
            }}
          />

          {/* Stereo Field Visualization */}
          <div className="flex items-center justify-between px-2 py-2 bg-gray-900 rounded border border-gray-700">
            {/* Left channel */}
            <div className="flex flex-col items-center gap-1">
              <div
                className="rounded-full transition-all"
                style={{
                  width: `${Math.max(8, 16 * (stereoWidth / 200))}px`,
                  height: `${Math.max(8, 16 * (stereoWidth / 200))}px`,
                  backgroundColor: getStereoFieldColor(stereoWidth),
                  opacity: 0.7,
                }}
              />
              <span className="text-xs text-gray-500">L</span>
            </div>

            {/* Center indicator */}
            <div className="text-xs font-bold text-gray-400">
              {getFieldLabel(stereoWidth)}
            </div>

            {/* Right channel */}
            <div className="flex flex-col items-center gap-1">
              <div
                className="rounded-full transition-all"
                style={{
                  width: `${Math.max(8, 16 * (stereoWidth / 200))}px`,
                  height: `${Math.max(8, 16 * (stereoWidth / 200))}px`,
                  backgroundColor: getStereoFieldColor(stereoWidth),
                  opacity: 0.7,
                }}
              />
              <span className="text-xs text-gray-500">R</span>
            </div>
          </div>

          {/* Quick Presets */}
          <div className="flex gap-1">
            {[
              { label: 'MONO', value: 0 },
              { label: 'N', value: 100 },
              { label: 'W', value: 150 },
            ].map((preset) => (
              <button
                key={preset.value}
                onClick={() => onStereoWidthChange(preset.value)}
                className={`flex-1 px-2 py-1 rounded text-xs font-semibold transition-all ${
                  stereoWidth === preset.value
                    ? 'bg-blue-600 text-white'
                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                }`}
              >
                {preset.label}
              </button>
            ))}
          </div>
        </div>
      </Tooltip>
    </div>
  );
}
