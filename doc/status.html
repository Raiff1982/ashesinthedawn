<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoreLogic Studio - System Status</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { margin-bottom: 30px; color: #60a5fa; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .status-card { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 20px; }
        .status-card h2 { font-size: 16px; margin-bottom: 10px; color: #cbd5e1; }
        .status-value { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .status-value.healthy { color: #10b981; }
        .status-value.error { color: #ef4444; }
        .status-value.pending { color: #f59e0b; }
        .status-detail { font-size: 12px; color: #94a3b8; margin-bottom: 5px; }
        .actions { display: flex; gap: 10px; margin-top: 30px; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        button:hover { background: #2563eb; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        .console-output { background: #0f172a; border: 1px solid #334155; border-radius: 8px; padding: 15px; margin-top: 20px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 400px; overflow-y: auto; }
        .log-line { margin-bottom: 5px; }
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-info { color: #60a5fa; }
        .log-warn { color: #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ CoreLogic Studio - System Status</h1>
        
        <div class="status-grid">
            <div class="status-card">
                <h2>Frontend</h2>
                <div class="status-value pending" id="frontend-status">Checking...</div>
                <div class="status-detail" id="frontend-detail">Port: 5173</div>
            </div>
            
            <div class="status-card">
                <h2>Backend (Codette)</h2>
                <div class="status-value pending" id="backend-status">Checking...</div>
                <div class="status-detail" id="backend-detail">Port: 8000</div>
            </div>
            
            <div class="status-card">
                <h2>WebSocket</h2>
                <div class="status-value pending" id="ws-status">Checking...</div>
                <div class="status-detail" id="ws-detail">ws://localhost:8000/ws</div>
            </div>
            
            <div class="status-card">
                <h2>Codette AI Engine</h2>
                <div class="status-value pending" id="ai-status">Checking...</div>
                <div class="status-detail" id="ai-detail">Real engine status</div>
            </div>
        </div>

        <div class="actions">
            <button onclick="runTests()">üîÑ Run All Tests</button>
            <button onclick="clearLogs()">üóëÔ∏è Clear Log</button>
            <button onclick="openFrontend()">üåê Open Frontend</button>
            <button onclick="openDocs()">üìö Open API Docs</button>
        </div>

        <div class="console-output" id="console"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const console_el = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            line.textContent = `[${timestamp}] ${message}`;
            console_el.appendChild(line);
            console_el.scrollTop = console_el.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('console').innerHTML = '';
        }

        async function checkFrontend() {
            try {
                const response = await fetch('/');
                if (response.ok) {
                    document.getElementById('frontend-status').className = 'status-value healthy';
                    document.getElementById('frontend-status').textContent = '‚úÖ Ready';
                    document.getElementById('frontend-detail').textContent = 'React dev server (port 5173)';
                    log('‚úÖ Frontend responding', 'success');
                    return true;
                }
            } catch (error) {
                document.getElementById('frontend-status').className = 'status-value error';
                document.getElementById('frontend-status').textContent = '‚ùå Error';
                document.getElementById('frontend-detail').textContent = 'Not responding';
                log('‚ùå Frontend error: ' + error.message, 'error');
                return false;
            }
        }

        async function checkBackend() {
            try {
                const response = await fetch('http://localhost:8000/health', {
                    headers: { 'Content-Type': 'application/json' }
                });
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('backend-status').className = 'status-value healthy';
                    document.getElementById('backend-status').textContent = '‚úÖ Running';
                    document.getElementById('backend-detail').textContent = `Codette ${data.service || 'AI Server'}`;
                    log('‚úÖ Backend responding on port 8000', 'success');
                    return data;
                }
            } catch (error) {
                document.getElementById('backend-status').className = 'status-value error';
                document.getElementById('backend-status').textContent = '‚ùå Offline';
                document.getElementById('backend-detail').textContent = `Error: ${error.message}`;
                log('‚ùå Backend not responding: ' + error.message, 'error');
                return null;
            }
        }

        async function checkWebSocket() {
            return new Promise((resolve) => {
                try {
                    const ws = new WebSocket('ws://localhost:8000/ws');
                    const timeout = setTimeout(() => {
                        ws.close();
                        document.getElementById('ws-status').className = 'status-value error';
                        document.getElementById('ws-status').textContent = '‚ùå Timeout';
                        log('‚ùå WebSocket connection timeout', 'error');
                        resolve(false);
                    }, 5000);

                    ws.onopen = () => {
                        clearTimeout(timeout);
                        document.getElementById('ws-status').className = 'status-value healthy';
                        document.getElementById('ws-status').textContent = '‚úÖ Connected';
                        log('‚úÖ WebSocket connection successful', 'success');
                        ws.close();
                        resolve(true);
                    };

                    ws.onerror = (error) => {
                        clearTimeout(timeout);
                        document.getElementById('ws-status').className = 'status-value error';
                        document.getElementById('ws-status').textContent = '‚ùå Error';
                        log('‚ùå WebSocket error: ' + error, 'error');
                        resolve(false);
                    };
                } catch (error) {
                    document.getElementById('ws-status').className = 'status-value error';
                    document.getElementById('ws-status').textContent = '‚ùå Failed';
                    log('‚ùå WebSocket failed: ' + error.message, 'error');
                    resolve(false);
                }
            });
        }

        async function checkAIEngine() {
            try {
                const response = await fetch('http://localhost:8000/codette/status');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('ai-status').className = 'status-value healthy';
                    document.getElementById('ai-status').textContent = '‚úÖ Ready';
                    const features = [
                        data.real_engine ? 'Real' : 'Mock',
                        data.training_available ? 'Training' : 'No Training',
                        data.analyzer_available ? 'Analyzer' : 'No Analyzer'
                    ].join(' + ');
                    document.getElementById('ai-detail').textContent = features;
                    log('‚úÖ AI Engine: ' + features, 'success');
                    return true;
                }
            } catch (error) {
                document.getElementById('ai-status').className = 'status-value error';
                document.getElementById('ai-status').textContent = '‚ùå Unavailable';
                log('‚ùå AI Engine error: ' + error.message, 'error');
                return false;
            }
        }

        async function runTests() {
            log('üîÑ Starting system tests...', 'info');
            clearLogs();
            
            await checkFrontend();
            log('', 'info');
            
            const backendData = await checkBackend();
            log('', 'info');
            
            await checkWebSocket();
            log('', 'info');
            
            await checkAIEngine();
            log('', 'info');

            if (backendData?.real_engine) {
                log('‚úÖ System ready! Open http://localhost:5173 to use CoreLogic Studio', 'success');
            } else {
                log('‚ö†Ô∏è Some services need attention. Check errors above.', 'warn');
            }
        }

        function openFrontend() {
            window.location.href = 'http://localhost:5173';
        }

        function openDocs() {
            window.open('http://localhost:8000/docs', '_blank');
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            log('üìä System Status Page Loaded', 'info');
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
