â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    RPC FUNCTION SIGNATURES - VISUAL GUIDE                  â•‘
â•‘                           December 2, 2025                                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ SIGNATURE 1: Suggestions Endpoint â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Function Name:  get_music_suggestions(text, text)                         â”‚
â”‚  Location:       /codette/suggest endpoint (Line 1772)                     â”‚
â”‚                                                                              â”‚
â”‚  Parameters:                                                                 â”‚
â”‚  â”œâ”€ p_prompt    : text    â†’ Context type ("mixing", "mastering", etc.)     â”‚
â”‚  â””â”€ p_context   : text    â†’ Category filter (same as p_prompt typically)   â”‚
â”‚                                                                              â”‚
â”‚  Returns:                                                                    â”‚
â”‚  â”œâ”€ id          : uuid                                                      â”‚
â”‚  â”œâ”€ topic       : text    â†’ e.g., "jazz_ballad"                            â”‚
â”‚  â”œâ”€ category    : text    â†’ e.g., "harmony"                                â”‚
â”‚  â”œâ”€ suggestion  : jsonb   â†’ Nested object with title, description          â”‚
â”‚  â””â”€ confidence  : float8  â†’ Score 0.85-0.92                                â”‚
â”‚                                                                              â”‚
â”‚  Example Call:                                                               â”‚
â”‚  supabase_client.rpc('get_music_suggestions',                              â”‚
â”‚    {'p_prompt': 'mixing', 'p_context': 'mixing'})                          â”‚
â”‚                                                                              â”‚
â”‚  SQL:                                                                        â”‚
â”‚  SELECT * FROM public.get_music_suggestions('mixing', 'mixing');           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SIGNATURE 2: Chat Semantic Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Function Name:  get_music_suggestions(text, integer)                      â”‚
â”‚  Location:       /codette/chat endpoint (Line 1263)                        â”‚
â”‚                                                                              â”‚
â”‚  Parameters:                                                                 â”‚
â”‚  â”œâ”€ query       : text    â†’ User search query ("How do I set up reverb?")  â”‚
â”‚  â””â”€ limit_count : integer â†’ Number of results (default: 3)                 â”‚
â”‚                                                                              â”‚
â”‚  Returns:                                                                    â”‚
â”‚  â”œâ”€ id          : uuid                                                      â”‚
â”‚  â”œâ”€ topic       : text                                                      â”‚
â”‚  â”œâ”€ category    : text                                                      â”‚
â”‚  â”œâ”€ suggestion  : jsonb   â†’ Full suggestion object                         â”‚
â”‚  â”œâ”€ confidence  : float8                                                    â”‚
â”‚  â””â”€ content     : text    â†’ Extracted title from suggestion                â”‚
â”‚                                                                              â”‚
â”‚  Example Call:                                                               â”‚
â”‚  supabase_client.rpc('get_music_suggestions',                              â”‚
â”‚    {'query': 'reverb settings', 'limit': 3})                               â”‚
â”‚                                                                              â”‚
â”‚  SQL:                                                                        â”‚
â”‚  SELECT * FROM public.get_music_suggestions('reverb', 3);                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SIGNATURE 3: Context Retrieval â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  Function Name:  get_codette_context(text, text)                           â”‚
â”‚  Location:       /codette/chat endpoint (Line 931)                         â”‚
â”‚                                                                              â”‚
â”‚  Parameters:                                                                 â”‚
â”‚  â”œâ”€ input_prompt         : text    â†’ User message for context              â”‚
â”‚  â””â”€ optionally_filename  : text    â†’ Optional filename (usually NULL)      â”‚
â”‚                                                                              â”‚
â”‚  Returns:                                                                    â”‚
â”‚  â”œâ”€ id          : uuid                                                      â”‚
â”‚  â”œâ”€ topic       : text                                                      â”‚
â”‚  â”œâ”€ category    : text                                                      â”‚
â”‚  â”œâ”€ suggestion  : jsonb                                                     â”‚
â”‚  â””â”€ confidence  : float8                                                    â”‚
â”‚                                                                              â”‚
â”‚  Example Call:                                                               â”‚
â”‚  supabase_client.rpc('get_codette_context',                                â”‚
â”‚    {'input_prompt': 'What should I do?', 'optionally_filename': None})     â”‚
â”‚                                                                              â”‚
â”‚  SQL:                                                                        â”‚
â”‚  SELECT * FROM public.get_codette_context('reverb', NULL);                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              PROBLEM ANALYSIS                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  Current Error:  permission denied for function get_music_suggestions     â•‘
â•‘  Error Code:     42501 (PostgreSQL)                                        â•‘
â•‘                                                                              â•‘
â•‘  Root Causes:                                                                â•‘
â•‘  â€¢ Functions do not exist in Supabase                                       â•‘
â•‘  â€¢ OR functions exist but lack EXECUTE permission for anon role             â•‘
â•‘                                                                              â•‘
â•‘  Impact:                                                                     â•‘
â•‘  â€¢ Backend catches exception silently                                       â•‘
â•‘  â€¢ Falls back to hardcoded suggestions                                      â•‘
â•‘  â€¢ Suggestions show "source": "fallback"                                    â•‘
â•‘  â€¢ Real database suggestions (confidence 0.92) are never used               â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                  SOLUTION                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  1. Open:  https://app.supabase.com â†’ Project â†’ SQL Editor                 â•‘
â•‘                                                                              â•‘
â•‘  2. Copy:  Contents of supabase_migration_fix_rpc.sql                      â•‘
â•‘                                                                              â•‘
â•‘  3. Paste & Run:  All three function definitions                            â•‘
â•‘                                                                              â•‘
â•‘  4. Verify:  Look for success messages                                      â•‘
â•‘             "Function get_music_suggestions(text, text) created..."        â•‘
â•‘                                                                              â•‘
â•‘  5. Restart:  python codette_server_unified.py                             â•‘
â•‘                                                                              â•‘
â•‘  6. Test:  Suggestions should now show "source": "database"                â”‚
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          DATA AVAILABILITY STATUS                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘  music_knowledge table ..................... âœ… EXISTS (5+ rows)           â•‘
â•‘  Sample data: Jazz harmony suggestions .... âœ… VERIFIED                    â•‘
â•‘  Confidence scores (0.85-0.92) ............ âœ… GOOD QUALITY                â•‘
â•‘  Embeddings (1536-dim vectors) ............ âœ… AVAILABLE                   â•‘
â•‘  Full-text search enabled ................. âœ… YES                         â•‘
â•‘                                                                              â•‘
â•‘  RPC Function: get_music_suggestions ..... âŒ MISSING/NO PERMISSION        â•‘
â•‘  RPC Function: get_codette_context ....... âŒ MISSING/NO PERMISSION        â•‘
â•‘                                                                              â•‘
â•‘  Fix Status:  âœ… READY (SQL migration provided)                            â•‘
â•‘  Difficulty:  ğŸŸ¢ EASY (Copy-paste, <2 minutes)                             â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DOCUMENTATION FILES:
  â€¢ ANSWER_RPC_SIGNATURES.md ........... Direct answer to your request
  â€¢ RPC_QUICK_REFERENCE.md ............ One-page cheat sheet
  â€¢ SUPABASE_FIX_GUIDE.md ............. Step-by-step instructions
  â€¢ supabase_migration_fix_rpc.sql .... Copy-paste ready SQL
  â€¢ RPC_SIGNATURE_ANALYSIS.md ......... Technical deep dive
  â€¢ SESSION_SUMMARY_RPC_ANALYSIS.md ... Complete analysis summary
